<?php $__env->startSection('content'); ?>

<div class="row">
    <div class="col-md-12">
        <form novalidate="novalidate" class="form-horizontal form-groups-bordered validate" method="post" id="sales_filter">
            <div data-collapsed="0" class="panel panel-primary">
                <div class="panel-heading">
                    <div class="panel-title">
                        Filter
                    </div>
                    <div class="panel-options">
                        <a data-rel="collapse" href="#">
                            <i class="entypo-down-open"></i>
                        </a>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label class="col-sm-1 control-label" for="Startdate">Start date</label>
                        <div class="col-sm-2">
                            <input type="text" name="Startdate" class="form-control datepicker"   data-date-format="yyyy-mm-dd" value="<?php echo $original_startdate; ?>" data-enddate="<?php echo date('Y-m-d'); ?>" />
                        </div>
                        <label class="col-sm-1 control-label" for="field-1">End Date</label>
                        <div class="col-sm-2">
                            <input type="text" name="Enddate" class="form-control datepicker"   data-date-format="yyyy-mm-dd" value="<?php echo $original_enddate; ?>" data-enddate="<?php echo date('Y-m-d', strtotime('+1 day') ); ?>" />
                        </div>
                        <label class="col-sm-1 control-label">Compare to previous period</label>
                        <div class="col-sm-1">
                            <p class="make-switch switch-small">
                                <input id="compare_with" name="compare_with" <?php if($compare_with == 1): ?> checked <?php endif; ?> type="checkbox" value="1">
                            </p>
                        </div>
                        <?php if(User::is_admin()): ?>
                         <label for="field-1" class="col-sm-1 control-label">Account Owner</label>
                        <div class="col-sm-2">
                        <?php echo Form::select('account_owners',$account_owners,$userID,array("class"=>"select2")); ?>

                        </div>
                        <?php endif; ?>

                    </div>
                    <p style="text-align: right;">
                        <button class="btn btn-primary btn-sm btn-icon icon-left" type="submit">
                            <i class="entypo-search"></i>Search
                        </button>
                    </p>
                </div>
            </div>
        </form>
    </div>
</div>


<div class="row">
    <?php if(isset($dashboardData['data']['TotalSales'])): ?>
    <div class="col-sm-6">
        <div class="panel panel-primary panel-table">
            <div class="panel-heading">
                <div class="panel-title">
                    <h3>Total Sales</h3>
                    <span>For selected period</span>
                </div>

                <div class="panel-options">
                    <a data-rel="collapse" href="#"><i class="entypo-down-open"></i></a>
                    <a data-rel="reload" href="#"><i class="entypo-arrows-ccw"></i></a>
                    <a data-rel="close" href="#"><i class="entypo-cancel"></i></a>
                </div>
            </div>
            <div class="panel-body">
                <table class="table table-responsive">
                    <thead>
                    <tr>
                        <th >Current Sales</th>

                        <?php if(isset($dashboardData['data']['PrevTotalSales'][0]->PrevTotalCharges) && $compare_with == 1): ?>
                        <th >Previous Sales</th>
                        <?php endif; ?>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <?php if(isset($dashboardData['data']['TotalSales'][0]->TotalCharges)): ?>
                        <td><a><?php echo $dashboardData['data']['TotalSales'][0]->TotalCharges; ?></a></td>
                        <?php endif; ?>
                        <?php if(isset($dashboardData['data']['PrevTotalSales'][0]->PrevTotalCharges) && $compare_with == 1): ?>
                        <td><a><?php echo $dashboardData['data']['PrevTotalSales'][0]->PrevTotalCharges; ?></a></td>
                        <?php endif; ?>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <?php endif; ?>
    <?php if(isset($dashboardData['data']['TotalActiveAccount'])): ?>
    <div class="col-sm-6">
        <div class="panel panel-primary panel-table">
            <div class="panel-heading">
                <div class="panel-title">
                    <h3>Total Account</h3>
                    <span>For selected period</span>
                </div>

                <div class="panel-options">
                    <a data-rel="collapse" href="#"><i class="entypo-down-open"></i></a>
                    <a data-rel="reload" href="#"><i class="entypo-arrows-ccw"></i></a>
                    <a data-rel="close" href="#"><i class="entypo-cancel"></i></a>
                </div>
            </div>
            <div class="panel-body">
                <table class="table table-responsive">
                    <thead>
                    <tr>
                        <th >Active Account</th>
                        <th >InActive Account</th>
                        <?php if(isset($dashboardData['data']['PrevTotalActiveAccount'][0]->prevtotalactive) && $compare_with == 1): ?>
                        <th >Previous Active Account</th>
                        <?php endif; ?>
                        <?php if(isset($dashboardData['data']['PrevTotalInActiveAccount'][0]->prevtotalinactive) && $compare_with == 1): ?>
                        <th >Previous InActive Account</th>
                        <?php endif; ?>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <?php if(isset($dashboardData['data']['TotalActiveAccount'][0]->totalactive)): ?>
                        <td><a><?php echo $dashboardData['data']['TotalActiveAccount'][0]->totalactive; ?></a></td>
                        <?php endif; ?>
                        <?php if(isset($dashboardData['data']['TotalInActiveAccount'][0]->totalinactive)): ?>
                        <td><a><?php echo $dashboardData['data']['TotalInActiveAccount'][0]->totalinactive; ?></a></td>
                        <?php endif; ?>
                        <?php if(isset($dashboardData['data']['PrevTotalActiveAccount'][0]->prevtotalactive) && $compare_with == 1): ?>
                        <td><a><?php echo $dashboardData['data']['PrevTotalActiveAccount'][0]->prevtotalactive; ?></a></td>
                        <?php endif; ?>
                        <?php if(isset($dashboardData['data']['PrevTotalInActiveAccount'][0]->prevtotalinactive) && $compare_with == 1): ?>
                        <td><a><?php echo $dashboardData['data']['PrevTotalInActiveAccount'][0]->prevtotalinactive; ?></a></td>
                        <?php endif; ?>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <?php endif; ?>

    </div>
<div class="row">
<?php if(isset($dashboardData['data']['AccountSales'])): ?>

    <div class="col-sm-6">
        <div class="panel panel-primary panel-table">
            <div class="panel-heading">
                <div class="panel-title">
                    <h3>Active Account Sales <?php if(isset($dashboardData['data']['TotalActiveAccount'][0]->totalactive)): ?>(<?php echo $dashboardData['data']['TotalActiveAccount'][0]->totalactive; ?>)<?php endif; ?></h3>
                    <span>For selected period</span>
                </div>
                <div class="panel-options">
                    <a data-rel="collapse" href="#">
                        <i class="entypo-down-open"></i>
                    </a>
                    <a data-rel="reload" href="#">
                        <i class="entypo-arrows-ccw"></i>
                    </a>
                    <a data-rel="close" href="#">
                        <i class="entypo-cancel"></i>
                    </a>
                </div>
            </div>
            <div class="panel-body" style="max-height: 300px; overflow-y: auto; overflow-x: hidden;">
                <table class="table table-responsive">
                    <thead>
                        <tr>
                            <th >Account Name</th>
                            <th >Current Sales</th>
                            <?php if($compare_with == 1): ?>
                            <th >Previous Sales</th>
                            <?php endif; ?>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach($dashboardData['data']['AccountSales'] as $account): ?>
                        <tr>
                            <td>
                                <a href="<?php echo action('SummaryController@summrybycountry'); ?>"><?php echo $account->AccountName; ?></a>
                            </td>
                            <td>
                                <a><?php echo $account->TotalCharges; ?></a>
                            </td>
                        <?php if( $compare_with == 1): ?>

                            <?php if(isset($prevsales[$account->GatewayAccountID])): ?>
                            <td>
                                <a><?php echo $prevsales[$account->GatewayAccountID]; ?></a>
                            </td>
                            <?php else: ?>
                            <td>
                                <a>0.00</a>
                            </td>
                            <?php endif; ?>
                         <?php endif; ?>
                        </tr>
                        <?php endforeach; ?>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <?php endif; ?>
    <?php if(isset($dashboardData['data']['TotalInActiveAccountList'])): ?>

        <div class="col-sm-6">
            <div class="panel panel-primary panel-table">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h3>InActive Accounts <?php if(isset($dashboardData['data']['TotalInActiveAccount'][0]->totalinactive)): ?>(<?php echo $dashboardData['data']['TotalInActiveAccount'][0]->totalinactive; ?>)<?php endif; ?> </h3>
                        <span>For selected period</span>
                    </div>
                    <div class="panel-options">
                        <a data-rel="collapse" href="#">
                            <i class="entypo-down-open"></i>
                        </a>
                        <a data-rel="reload" href="#">
                            <i class="entypo-arrows-ccw"></i>
                        </a>
                        <a data-rel="close" href="#">
                            <i class="entypo-cancel"></i>
                        </a>
                    </div>
                </div>
                <div class="panel-body" style="max-height: 300px; overflow-y: auto; overflow-x: hidden;">
                    <table class="table table-responsive">
                        <thead>
                            <tr>
                                <th >Account Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach($dashboardData['data']['TotalInActiveAccountList'] as $account): ?>
                            <tr>
                                <td>
                                    <a><?php echo $account->AccountName; ?></a>
                                </td>
                            </tr>
                            <?php endforeach; ?>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <?php endif; ?>


</div>
<div class="row">
<?php if(isset($dashboardData['data']['PrevTotalInActiveAccountList']) && $compare_with == 1): ?>

        <div class="col-sm-6">
            <div class="panel panel-primary panel-table">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h3>Previous InActive Accounts <?php if(isset($dashboardData['data']['PrevTotalInActiveAccount'][0]->prevtotalinactive) && $compare_with == 1): ?>(<?php echo $dashboardData['data']['PrevTotalInActiveAccount'][0]->prevtotalinactive; ?>)<?php endif; ?> </h3>
                        <span>For selected period</span>
                    </div>
                    <div class="panel-options">
                        <a data-rel="collapse" href="#">
                            <i class="entypo-down-open"></i>
                        </a>
                        <a data-rel="reload" href="#">
                            <i class="entypo-arrows-ccw"></i>
                        </a>
                        <a data-rel="close" href="#">
                            <i class="entypo-cancel"></i>
                        </a>
                    </div>
                </div>
                <div class="panel-body" style="max-height: 300px; overflow-y: auto; overflow-x: hidden;">
                    <table class="table table-responsive">
                        <thead>
                            <tr>
                                <th >Account Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach($dashboardData['data']['PrevTotalInActiveAccountList'] as $account): ?>
                            <tr>
                                <td>
                                    <a><?php echo $account->AccountName; ?></a>
                                </td>
                            </tr>
                            <?php endforeach; ?>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <?php endif; ?>
</div>
<div class="row">
    <div class="col-sm-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="panel-title">Top Destination</div>
                </div>
                <div class="panel-body">
                    <label >Current</label>
                    <?php if(isset($top_data)): ?>
                    <div class="pie-large" id="pie-large" style="height: 350px">
                    </div>
                    <?php else: ?>
                         <center>
                        No Data Found
                        </center>
                    <?php endif; ?>
                    <?php if( $compare_with == 1): ?>
                    <label >Previous</label>
                    <?php if(isset($prev_top_data)): ?>
                            <div class="pie-large-prev" id="pie-large-prev" style="height: 350px">
                            </div>
                    <?php else: ?>
                         <center>
                        No Data Found
                        </center>
                    <?php endif; ?>
                    <?php endif; ?>
                </div>
            </div>
        </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <div id="charts_env" class="panel panel-primary">
            <div class="panel-heading">
                <div class="panel-title">Sales Chart</div>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                <?php if(isset($sales_data)): ?>
                    <div class="tab-pane active" id="line-chart">
                        <div id="line-chart-sales" class="morrischart" style="height: 300px"></div>
                    </div>
                <?php else: ?>
                     <center>
                    No Data Found
                    </center>
                <?php endif; ?>
                </div>
            </div>
        </div>
    </div>
</div>
<?php if(User::is_admin()): ?>
<div class="row">
    <div class="col-sm-12">
        <div id="charts_env" class="panel panel-primary">
            <div class="panel-heading">
                <div class="panel-title">Leadership Chart</div>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                <?php if(isset($dashboardData['data']['SalesExecutive']) && count($dashboardData['data']['SalesExecutive'])): ?>
                    <div class="tab-pane active" id="line-chart-2">
                        <div id="bar-chart" class="morrischart" style="height: 300px"></div>
                    </div>
                <?php else: ?>
                     <center>
                    No Data Found
                    </center>
                <?php endif; ?>
                </div>
            </div>
        </div>
    </div>

</div>
<?php endif; ?>
<script>
 jQuery(document).ready(function ($) {
    	// Line Charts
        <?php if(isset($sales_data)): ?>
        var line_chart_demo = $("#line-chart-sales");
        var sales_data =  [];
        var ykeys = [];
        ykeys[0]= 'a';
                <?php foreach($sales_data as $key => $saledatrow): ?>

                        <?php if(isset($prev_sales_data)  && $compare_with == 1): ?>
                         sales_data['<?php echo $key; ?>'] = { y: '<?php echo $saledatrow['sale_date']; ?>', a: '<?php echo $saledatrow['sales']; ?>' ,b:'<?php echo $prev_sales_data[$saledatrow['sale_date']]['sales']; ?>'};
                         ykeys[1]= 'b';
                         <?php else: ?>
                         sales_data['<?php echo $key; ?>'] = { y: '<?php echo $saledatrow['sale_date']; ?>', a: '<?php echo $saledatrow['sales']; ?>'};
                        <?php endif; ?>

                <?php endforeach; ?>

            Morris.Line({
                element: 'line-chart-sales',
                data: sales_data,
                xkey: 'y',
                ykeys: ykeys,
                labels:['current sales','previous sales'],
                redraw: true,
                parseTime: false
            });
            line_chart_demo.parent().attr('style', '');
    	<?php endif; ?>
    	<?php if(isset($dashboardData['data']['SalesExecutive']) && count($dashboardData['data']['SalesExecutive'])): ?>
    	var line_chart_demo_2 = $("#bar-chart");
    	var sales_data_2 =  [];
    	var ykeys_2 = [];
                ykeys_2[0]= 'a';

            <?php foreach($dashboardData['data']['SalesExecutive'] as $key => $SalesExecutiverow): ?>
                <?php if(isset($prev_sales_data)  && $compare_with == 1): ?>
                 sales_data_2['<?php echo $key; ?>'] = { y: '<?php echo $SalesExecutiverow->FullName; ?>', a: '<?php echo $SalesExecutiverow->TotalCharges; ?>' ,b:'<?php echo $prevSalesExecutive[$SalesExecutiverow->Owner]; ?>'};
                 ykeys_2[1]= 'b';
                 <?php else: ?>
                 sales_data_2['<?php echo $key; ?>'] = { y: '<?php echo $SalesExecutiverow->FullName; ?>', a: '<?php echo $SalesExecutiverow->TotalCharges; ?>'};
                <?php endif; ?>
            <?php endforeach; ?>
            Morris.Bar({
                        element: 'bar-chart',
                        data: sales_data_2,
                        xkey: 'y',
                        ykeys: ykeys_2,
                        labels:['current sales','previous sales'],
                        barColors: ['#269FFF', '#90D1FF', '#d13c3e'],
                        parseTime: false
                    });
            line_chart_demo_2.parent().attr('style', '');
        <?php endif; ?>
    	<?php if(isset($top_data)): ?>
    	var offset_str ='';
            <?php foreach($top_data as $key => $toprow): ?>
                <?php if($key<count($top_data)-1): ?>
                offset_str += '{"label":"<?php echo $toprow['code']; ?>","value":"<?php echo $toprow['sales']; ?>"},';
                <?php else: ?>
                offset_str += '{"label":"<?php echo $toprow['code']; ?>","value":"<?php echo $toprow['sales']; ?>"}';
                <?php endif; ?>
            <?php endforeach; ?>
            pie_chart('pie-large',JSON.parse("[" + offset_str + "]"));
    	<?php endif; ?>
    	<?php if(isset($prev_top_data)): ?>
    	    var prev_offset_str =  '';
            <?php foreach($prev_top_data as $key => $toprow): ?>
                <?php if($key<count($prev_top_data)-1): ?>
                prev_offset_str += '{"label":"<?php echo $toprow['code']; ?>","value":"<?php echo $toprow['sales']; ?>"},';
                <?php else: ?>
                prev_offset_str += '{"label":"<?php echo $toprow['code']; ?>","value":"<?php echo $toprow['sales']; ?>"}';
                <?php endif; ?>
            <?php endforeach; ?>
            pie_chart('pie-large-prev',JSON.parse("[" + prev_offset_str + "]"));
        <?php endif; ?>

	});

</script>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('layout.main', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>